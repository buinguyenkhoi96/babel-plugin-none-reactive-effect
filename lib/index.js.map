{"version":3,"file":"index.js","names":["_fs","_interopRequireDefault","require","obj","__esModule","PACKAGE_NAME","PLUGIN_NAME","visitor","ImportDeclaration","path","state","get","isStringLiteral","value","importedPackageName","node","name","VariableDeclarator","t","isCallExpression","isIdentifier","isArrayPattern","length","variableNames","push","id","elements","identifier","concat","Identifier","includes","useEffectCallExpressionPath","find","parentPath","isArrayExpression","some","dependenciesListPath","_default","_ref","types","Program","fs","writeFileSync","JSON","stringify","traverse"],"sources":["../src/index.js"],"sourcesContent":["import fs from 'fs';\n\nconst PACKAGE_NAME = 'useStateMix';\nconst PLUGIN_NAME = 'babel-plugin-none-reactive-effect';\n\nconst visitor = {\n  ImportDeclaration(path, state) {\n    if (path.get('source').isStringLiteral({ value: PACKAGE_NAME })) {\n      state.importedPackageName = path.get('specifiers.0.local').node.name;\n    }\n  },\n  VariableDeclarator(path, state) {\n    const { t, importedPackageName } = state;\n\n    if (\n      path.get('init').isCallExpression() &&\n      path.get('init.callee').isIdentifier({ name: importedPackageName }) &&\n      path.get('id').isArrayPattern() &&\n      path.get('id.elements').length === 2\n    ) {\n      state.variableNames.push(path.get('id.elements.0').node.name);\n      path.node.id.elements.push(t.identifier(`${path.get('id.elements.0').node.name}Ref`));\n    }\n  },\n  Identifier(path, state) {\n    const { t } = state;\n\n    if (!state.variableNames.includes(path.node.name)) {\n      return;\n    }\n\n    const useEffectCallExpressionPath = path.find((parentPath) =>\n      t.isCallExpression(parentPath.node) &&\n      t.isIdentifier(parentPath.get('callee').node, { name: 'useEffect' }));\n\n    if (\n      !useEffectCallExpressionPath\n      || useEffectCallExpressionPath.get('arguments').length < 2\n      || !useEffectCallExpressionPath.get('arguments.1').isArrayExpression()\n      || useEffectCallExpressionPath.get('arguments.1.elements').some((dependenciesListPath) => t.isIdentifier(dependenciesListPath.node, { name: path.node.name }))\n    ) {\n      return;\n    }\n\n    path.node.name = `${path.node.name}Ref`;\n  }\n};\n\nexport default function ({ types: t }) {\n  return {\n    name: PLUGIN_NAME,\n    visitor: {\n      Program(path, state) {\n        fs.writeFileSync('./ast.json', JSON.stringify(path.node, null, 2));\n        path.traverse(visitor, { t, variableNames: [], importedPackageName: '' });\n      },\n    }\n  };\n}"],"mappings":"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","ignoreList":[]}